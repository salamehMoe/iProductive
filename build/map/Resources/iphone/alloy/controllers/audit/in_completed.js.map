{"version":3,"sources":["template.js","app/controllers/audit/in_completed.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ADlDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"/Users/exsalameh/Desktop/iProductive-2/Resources/iphone/alloy/controllers/audit/in_completed.js","sourceRoot":"/Users/exsalameh/Desktop/iProductive-2","sourcesContent":["var Alloy = require('/alloy'),\n\tBackbone = Alloy.Backbone,\n\t_ = Alloy._;\n\n\n\n\nfunction __processArg(obj, key) {\n\tvar arg = null;\n\tif (obj) {\n\t\targ = obj[key] || null;\n\t}\n\treturn arg;\n}\n\nfunction Controller() {\n\t\n\trequire('/alloy/controllers/' + 'BaseController').apply(this, Array.prototype.slice.call(arguments));\n\tthis.__controllerPath = 'audit/in_completed';\n\tthis.args = arguments[0] || {};\n\n\tif (arguments[0]) {\n\t\tvar __parentSymbol = __processArg(arguments[0], '__parentSymbol');\n\t\tvar $model = __processArg(arguments[0], '$model');\n\t\tvar __itemTemplate = __processArg(arguments[0], '__itemTemplate');\n\t}\n\tvar $ = this;\n\tvar exports = {};\n\tvar __defers = {};\n\n\t// Generated code that must be executed before all UI and/or\n\t// controller code. One example is all model and collection\n\t// declarations from markup.\n\tAlloy.Collections.instance('auditRecord');\n\n\t// Generated UI code\n\t$.__views[\"inCompleted\"] = (require(\"xp.ui\").createWindow || Ti.UI.createWindow)(\n{backgroundColor:\"#ffffff\",translucent:true,tintColor:Alloy.CFG.tintColor,navTintColor:\"#ffffff\",barColor:Alloy.CFG.borderColor,includeOpaqueBars:true,autoAdjustScrollViewInsets:false,statusBarStyle:Ti.UI.iOS.StatusBar.LIGHT_CONTENT,extendEdges:[Ti.UI.EXTEND_EDGE_TOP,Ti.UI.EXTEND_EDGE_BOTTOM,],title:\"In Progress\",id:\"inCompleted\",}\n);\n$.__views[\"inCompleted\"] && $.addTopLevelView($.__views[\"inCompleted\"]);\n$.__views[\"__alloyId45\"] = Alloy.createController('centerNavBtns',{id:\"__alloyId45\",__parentSymbol:$.__views[\"inCompleted\"],});\n$.__views[\"__alloyId45\"].setParent($.__views[\"inCompleted\"]);\nif ((OS_IOS)) {\n$.__views[\"__alloyId46\"] = Ti.UI.createSearchBar(\n{hintText:\"Search ...\",barColor:\"#115EAC\",tintColor:\"#ffffff\",keyboardType:Titanium.UI.RETURNKEY_SEARCH,returnKeyType:Titanium.UI.RETURNKEY_SEARCH,id:\"__alloyId46\",}\n);\n}\nvar __alloyId47={};var __alloyId50=[];var __alloyId51={type:'Ti.UI.Label',bindId:'info',properties:{textAlign:Titanium.UI.TEXT_ALIGNMENT_LEFT,color:\"black\",left:\"10dp\",top:\"15dp\",bindId:\"info\",},};__alloyId50.push(__alloyId51);var __alloyId52={type:'Ti.UI.Label',bindId:'es_info',properties:{textAlign:Titanium.UI.TEXT_ALIGNMENT_LEFT,font:{fontSize:\"10dp\",},left:\"10dp\",top:\"40dp\",color:\"black\",bindId:\"es_info\",},};__alloyId50.push(__alloyId52);var __alloyId49 = {properties:{name:\"template\",},childTemplates:__alloyId50,};__alloyId47[\"template\"]=__alloyId49;$.__views[\"headerView\"] = Ti.UI.createView(\n{backgroundColor:\"#efefef\",height:60,id:\"headerView\",}\n);\n$.__views[\"__alloyId56\"] = Ti.UI.createLabel(\n{textAlign:Titanium.UI.TEXT_ALIGNMENT_LEFT,text:'Audits started but not yet completed',id:\"__alloyId56\",}\n);\n$.__views[\"headerView\"].add($.__views[\"__alloyId56\"]);\nif ((OS_IOS)) {\n$.__views[\"editBtn\"] = Ti.UI.createButton(\n{right:20,title:'Edit',id:\"editBtn\",}\n);\n$.__views[\"headerView\"].add($.__views[\"editBtn\"]);\n}\n$.__views[\"__alloyId53\"] = Ti.UI.createListSection(\n{headerView:$.__views[\"headerView\"],id:\"__alloyId53\",}\n);\nvar __alloyId60=Alloy.Collections['auditRecord'] || auditRecord;function __alloyId61(e) {   if (e && e.fromAdapter) { return; }   var opts = __alloyId61.opts || {};\tvar models = __alloyId60.models;\tvar len = models.length;var __alloyId54=[];\tfor (var i = 0; i < len; i++) {\t\tvar __alloyId57 = models[i];\t\t__alloyId57.__transform = transformFunction(__alloyId57);var __alloyId59 = {properties:{height:70,accessoryType:Ti.UI.LIST_ACCESSORY_TYPE_DISCLOSURE,canEdit:true,title:__alloyId57.__transform.AuditName,searchableText:__alloyId57.__transform.AuditName,auditRecordID:__alloyId57.__transform.id,storeCode:__alloyId57.__transform.storeCode,deptCode:__alloyId57.__transform.deptCode,AuditID:__alloyId57.__transform.AuditID,openDate:__alloyId57.__transform.openDate,submisiondDate:__alloyId57.__transform.submisiondDate,submittedBy:__alloyId57.__transform.submittedBy,online_id:__alloyId57.__transform.online_id,CompanyTypeID:__alloyId57.__transform.CompanyTypeID,DeptCode:__alloyId57.__transform.DeptCode,AuditDesc:__alloyId57.__transform.AuditDesc,Target:__alloyId57.__transform.Target,type:__alloyId57.__transform.type,comment:__alloyId57.__transform.comment,},image:{text:\"delete\",},info:{text:__alloyId57.__transform.AuditName,},es_info:{text:__alloyId57.__transform.subTitle,},};__alloyId54.push(__alloyId59);\t}opts.animation ? $.__views[\"__alloyId53\"].setItems(__alloyId54, opts.animation) : $.__views[\"__alloyId53\"].items = __alloyId54;};__alloyId60.on('fetch destroy change add remove reset',__alloyId61);var __alloyId62=[];__alloyId62.push($.__views[\"__alloyId53\"]);$.__views[\"list\"] = Ti.UI.createListView(\n{defaultItemTemplate:\"template\",top:62,sections:__alloyId62,templates:__alloyId47,searchView:$.__views[\"__alloyId46\"],id:\"list\",}\n);\n$.__views[\"inCompleted\"].add($.__views[\"list\"]);\nopenTemplate?$.addListener($.__views[\"list\"],'itemclick',openTemplate):__defers['$.__views[\"list\"]!itemclick!openTemplate']=true;deleteMe?$.addListener($.__views[\"list\"],'delete',deleteMe):__defers['$.__views[\"list\"]!delete!deleteMe']=true;var __alloyId64 = [];__alloyId64.push(\"Yes\");__alloyId64.push(\"No\");$.__views[\"confirmDelete\"] = Ti.UI.createAlertDialog(\n{buttonNames:__alloyId64,message:\"Are you sure you want to delete?\",id:\"confirmDelete\",}\n);\nexports.destroy = function () {__alloyId60 && __alloyId60.off('fetch destroy change add remove reset',__alloyId61);};\n\n\t// make all IDed elements in $.__views available right on the $ in a\n\t// controller's internal code. Externally the IDed elements will\n\t// be accessed with getView().\n\t_.extend($, $.__views);\n\n\t// Controller code directly from the developer's controller file\n\t__MAPMARKER_CONTROLLER_CODE__\n\n\t// Generated code that must be executed after all UI and\n\t// controller code. One example deferred event handlers whose\n\t// functions are not defined until after the controller code\n\t// is executed.\n\t__defers['$.__views[\"list\"]!itemclick!openTemplate'] && $.addListener($.__views[\"list\"],'itemclick',openTemplate);__defers['$.__views[\"list\"]!delete!deleteMe'] && $.addListener($.__views[\"list\"],'delete',deleteMe);\n\n\t// Extend the $ instance with all functions and properties\n\t// defined on the exports object.\n\t_.extend($, exports);\n}\n\nmodule.exports = Controller;\n","var isdeleting = false;\n\nfunction confirmDelete(e) {\n  //TODO show alerDialog\n  isdeleting = true;\n  $.confirmDelete.show();\n  $.confirmDelete.addEventListener(\"click\", del);\n  function del(ev) {\n    if (ev.index == 0) {\n      //YES\n      //alert(\"YES\");\n      deleteMe(e);\n    } else if (ev.index == 1) {\n      //NO\n      //alert(\"NO\");\n    }\n    $.confirmDelete.removeEventListener(\"click\", del);\n  }\n\n}\n\nvar openTemplate = function (e) {\n  if (isdeleting) {\n    isdeleting = false;\n    return;\n  }\n  var item = e.section.getItemAt(e.itemIndex);\n\n  Alloy.Globals.pageStack.open(Alloy.createController('audit/sections', {\n    item: item.properties,\n    formPrams: {\n      auditRecordID: item.properties.auditRecordID,\n      deptCode: item.properties.deptCode,\n      store: item.properties.storeCode,\n      date: item.properties.openDate,\n      comment: item.properties.comment },\n\n    isEditing: true,\n    isIncomplete: refreshCollection }).\n  getView());\n\n};\n\nfunction transformFunction(model) {\n\n  var transform = model.toJSON();\n  transform.subTitle = transform.storeCode + \" / \" + moment(transform.openDate).format('DD-MM-YYYY HH:mm');\n\n  if (transform.WA == null) {\n\n    transform.subTitle = transform.subTitle;\n\n  } else {\n\n    transform.subTitle = transform.subTitle + \"    \" + (transform.WA / transform.WT * 100).toFixed(3) + \"%\";\n\n  }\n\n  return transform;\n}\n\nfunction deleteMe(e) {\n  isdeleting = true;\n  var auditRecordModel = Alloy.Collections.auditRecord.at(e.itemIndex);\n  auditRecordModel.destroyAllAnswers();\n  auditRecordModel.destroy();\n}\n\nif (OS_IOS) {\n  $.editBtn.addEventListener('click', function () {\n    $.list.editing = !$.list.editing;\n  });\n}\n\n\nfunction refreshCollection() {\n  try {\n    Alloy.Collections.auditRecord.fetch({\n      query: \"SELECT a.*, t.* ,sum(qu.QWeight) WT, sum((SELECT qu.QWeight  WHERE length(ans.AnswerDate)>0 )) WA FROM auditRecord a  JOIN templates t ON t.AuditID = a.AuditID LEFT JOIN questions qu ON qu.AuditID = a.auditID LEFT JOIN answers ans ON ans.QuestionID = qu.QuestionID  AND ans.AuditRecordID = a.id  WHERE submisiondDate = '' group by a.id\"\n      // query : \"SELECT a.*, t.* ,sum(qu.QWeight) WT, sum((SELECT qu.QWeight  WHERE length(ans.AnswerDate)>0 )) WA FROM auditRecord a  JOIN templates t ON t.AuditID = a.AuditID LEFT JOIN questions qu ON qu.AuditID = a.auditID LEFT JOIN answers ans ON ans.QuestionID = qu.QuestionID  AND ans.AuditRecordID = a.id AND a.submittedBy = \\\"\"+Alloy.Globals.user.get('ldap_user')+\"\\\"  WHERE submisiondDate = '' group by a.id\"\n    });\n\n\n    //Ti.API.Info('######### REFFFRESHINNNNN');\n  } catch (e) {\n    //Ti.API.Info('error -> '+JSON.stringify(e));\n  }\n\n}\n\n\nrefreshCollection();\n\n$.inCompleted.addEventListener(\"close\", function () {\n  $.destroy();\n});\n\n///\n// function updateCache() {\n//   var qCollaction = Alloy.createCollection('questions');\n//\n//   qCollaction.on('fetch', function() {\n//   \tqCollaction.each(function(model) {\n//   \t\tvar qCollectionJSON = model.toJSON();\n//       cacheDraftsQuestions(qCollectionJSON);\n//   \t});\n//   });\n// }\n//\n// function cacheDraftsQuestions(questions) {\n//\n// \tvar usersData = Ti.App.Properties.getList(\"CachedDataByUser\",[]);\n// \tif (usersData.filter(function(user){\n// \t\treturn user.user == Ti.App.Properties.getString('lastLoginUser',\"noUser\");\n// \t}).length) {\n// \t\tusersData.forEach(function(user, i){\n// \t\t\tif (user.user == Ti.App.Properties.getString('lastLoginUser',\"noUser\")) {\n// \t\t\t\tusersData[i].cachedDraftsQuestions = questions;\n// \t\t\t}\n// \t\t});\n// \t}\n//   Ti.App.Properties.setList(\"CachedDataByUser\",usersData);\n// }\n\n///\n\n\n\n\n//Ti.API.Info('<============ in in_complete, list length is:'+$.list.sections.length);"]}